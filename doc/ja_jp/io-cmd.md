# I/O コマンド仕様

## 基本通信仕様

``` mermaid
sequenceDiagram
    participant M as S-CPU(5A22)
    participant S as S-SMP(SPC)

    par
        M->>+S: command number (port 0)
    and
        opt
            M->>S: param 1 (port 1)
        end
    and
        opt
            M->>S: param 2 (port 2)
        end
    and
        opt
            M->>S: param 3 (port 3)
        end
    end

    S-->>-M: command number as ack (port 0)
```

コマンドは、I/Oポートの *Port0* に**0以外**の値を書き込むことで起動される。

追加のパラメータが存在する場合は、 *Port1* 〜 *Port3* に書き込まれる。

すべてのコマンドは、ack信号として *Port0* から
コマンド番号を *S-CPU (5A22)* に対して返す。

---

## コマンド

### [0xFF] IPL起動

  SPCのコントロールレジスタ (`addr: 0x00F1`) のIPL bitを立てた後、
  `addr: 0xFFC0` のIPLを起動する。

#### パラメータ

|Port| 値   | 概要         |
|---:|:-----|--------------|
| 0  | 0xff | コマンド番号 |


### [0x01] マスターボリューム設定

  DSPの **MVOL_L** (`dsp: 0x0c`) および **MVOL_R** (`dsp: 0x1c`) を設定する。

#### パラメータ

|Port| 値      | 概要                 |
|---:|:--------|----------------------|
| 0  | 0x01    | コマンド番号         |
| 1  | 0 - 127 | 左マスターボリューム |
| 2  | 0 - 127 | 右マスターボリューム |


### [0x02] ステレオ / モノラル 切り替え

  ステレオ / モノラル を切り替える。

#### パラメータ

|Port| 値        | 概要                      |
|---:|:----------|---------------------------|
| 0  | 0x02      | コマンド番号              |
| 1  | 0 or 1(※) | 0: ステレオ / 1: モノラル |

※ 正確には、**0以外**はモノラル化とする


### [0x03] Reserved

  音楽音量設定コマンドを予定


### [0x04] Reserved

  効果音音量設定コマンドを予定

  ただし、hseに効果音処理の実装予定はありません。

### [0x05] DSP 書き込み

  DSPレジスタに対して値を書き込む。

#### パラメータ

|Port| 値       | 概要                 |
|---:|:---------|----------------------|
| 0  | 0x05     | コマンド番号         |
| 1  | 0 - 0x7f | DSP アドレス         |
| 2  | 0 - 0xff | DSPへ書き込むデータ  |


### [0x06] SPC 書き込み

  SPC RAMの内容を書き換える。

#### パラメータ

|Port| 値       | 概要                    |
|---:|:---------|-------------------------|
| 0  | 0x06     | コマンド番号            |
| 1  | 0 - 0xff | SPC RAM アドレス (L)    |
| 2  | 0 - 0xff | SPC RAM アドレス (H)    |
| 3  | 0 - 0xff | SPC RAMへ書き込むデータ |


### [0x07] Reserved

  効果音の鳴動処理を予定

  ただし、hseへの実装予定は今のところありません。


### [0x08] フェード

  音楽をフェードイン／フェードアウトさせる

#### パラメータ

|Port| 値       | 概要                    |
|---:|:---------|-------------------------|
| 0  | 0x08     | コマンド番号            |
| 1  | 0 - 0xff | フェードtick数          |
| 2  | 0 - 0x7f | 音量                    |


### [0x09] 音楽変更


### [0x0A] 音楽データ転送

### [0x0B] ストリーム転送開始

### [0x0C] ストリーム転送再開

### [0x0D] ストリーム転送中断


